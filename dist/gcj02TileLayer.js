!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).gcj02TileLayer=e()}(this,function(){"use strict";Object.freeze=function(t){return t};var t=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();var e=/\{ *([\w_-]+) *\}/g;var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=3.141592653589793,a=6378245,n=.006693421622965943,o=3e3*r/180;function s(t,e,i){var a=r/180*e,n=Math.pow(2,i);return[parseInt((t+180)/360*n),parseInt((1-Math.asinh(Math.tan(a))/r)/2*n)]}function h(t,e){var i,r,a,n,s,h,l=(i=t-.0065,r=e-.006,a=Math.sqrt(i*i+r*r)-2e-5*Math.sin(r*o),n=Math.atan2(r,i)-3e-6*Math.cos(i*o),s=a*Math.cos(n),h=a*Math.sin(n),{lng:s,lat:h});return c(l.lng,l.lat)}function l(t,e){var i,r,a,n,s,h,l=u(t,e);return i=l.lng,r=l.lat,a=Math.sqrt(i*i+r*r)+2e-5*Math.sin(r*o),n=Math.atan2(r,i)+3e-6*Math.cos(i*o),s=a*Math.cos(n)+.0065,h=a*Math.sin(n)+.006,{lng:s,lat:h}}function u(t,e){if(i(t)){var o=t[0];e=t[1],t=o}if(t instanceof Object){o=t.lng;e=t.lat,t=o}var s=p(t-105,e-35),h=f(t-105,e-35),l=e/180*r,u=Math.sin(l);u=1-n*u*u;var c=Math.sqrt(u);return s=180*s/(a*(1-n)/(u*c)*r),{lng:t+(h=180*h/(a/c*Math.cos(l)*r)),lat:e+s}}function c(t,e){if(i(t)){var o=t[0];e=t[1],t=o}if(t instanceof Object){o=t.lng;e=t.lat,t=o}var s=function(t,e){var i=p(t-105,e-35),o=f(t-105,e-35),s=e/180*r,h=Math.sin(s);h=1-n*h*h;var l=Math.sqrt(h);return i=180*i/(a*(1-n)/(h*l)*r),o=180*o/(a/l*Math.cos(s)*r),{lng:t+o,lat:e+i}}(t,e);return{lng:2*t-s.lng,lat:2*e-s.lat}}function p(t,e){var i=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return i+=2*(20*Math.sin(6*t*r)+20*Math.sin(2*t*r))/3,i+=2*(20*Math.sin(e*r)+40*Math.sin(e/3*r))/3,i+=2*(160*Math.sin(e/12*r)+320*Math.sin(e*r/30))/3}function f(t,e){var i=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return i+=2*(20*Math.sin(6*t*r)+20*Math.sin(2*t*r))/3,i+=2*(20*Math.sin(t*r)+40*Math.sin(t/3*r))/3,i+=2*(150*Math.sin(t/12*r)+300*Math.sin(t/30*r))/3}function g(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function d(t){return"string"==typeof t}var M=void 0,v=null;function _(t,e){isNaN(t)&&(t=Ib(t),t=isNaN(t)?0:t),d(t)&&(t=parseFloat(t)),isNaN(e)&&(e=Ib(e),e=isNaN(e)?0:e),d(e)&&(e=parseFloat(e)),this.lng=t,this.lat=e}function x(t,e){this.x=t||0,this.y=e||0,this.x=this.x,this.y=this.y}function m(){}function b(){}_.TL=function(t){return t&&180>=t.lng&&-180<=t.lng&&74>=t.lat&&-74<=t.lat},_.prototype.lb=function(t){return t&&this.lat==t.lat&&this.lng==t.lng},x.prototype.lb=function(t){return t&&t.x==this.x&&t.y==this.y},m.prototype.nh=function(){aa("lngLatToPoint方法未实现")},m.prototype.wi=function(){aa("pointToLngLat方法未实现")},b.prototype=new m,g(b,{$O:6370996.81,lG:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Au:[75,60,45,30,15,0],fP:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],Z1:function(t,e){return t&&e&&(t=this.Fb(t))?(i=this.Tk(t.lng),r=this.Tk(t.lat),(e=this.Fb(e))?this.Pe(i,this.Tk(e.lng),r,this.Tk(e.lat)):0):0;var i,r},Vo:function(t,e){return t&&e?(t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74),e.lng=this.JD(e.lng,-180,180),e.lat=this.ND(e.lat,-74,74),this.Pe(this.Tk(t.lng),this.Tk(e.lng),this.Tk(t.lat),this.Tk(e.lat))):0},Fb:function(t){if(t===v||t===M)return new _(0,0);var e,i;e=new _(Math.abs(t.lng),Math.abs(t.lat));for(var r=0;r<this.lG.length;r++)if(e.lat>=this.lG[r]){i=this.fP[r];break}return new _((t=this.gK(t,i)).lng.toFixed(6),t.lat.toFixed(6))},Eb:function(t){if(t===v||t===M||180<t.lng||-180>t.lng||90<t.lat||-90>t.lat)return new _(0,0);var e,i;t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74),e=new _(t.lng,t.lat);for(var r=0;r<this.Au.length;r++)if(e.lat>=this.Au[r]){i=this.iG[r];break}if(!i)for(r=0;r<this.Au.length;r++)if(e.lat<=-this.Au[r]){i=this.iG[r];break}return new _((t=this.gK(t,i)).lng.toFixed(2),t.lat.toFixed(2))},gK:function(t,e){if(t&&e){var i=e[0]+e[1]*Math.abs(t.lng),r=Math.abs(t.lat)/e[9];r=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return new _(i=i*(0>t.lng?-1:1),r=r*(0>t.lat?-1:1))}},Pe:function(t,e,i,r){return this.$O*Math.acos(Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos(e-t))},Tk:function(t){return Math.PI*t/180},Z3:function(t){return 180*t/Math.PI},ND:function(t,e,i){return e!=v&&(t=Math.max(t,e)),i!=v&&(t=Math.min(t,i)),t},JD:function(t,e,i){for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}}),g(b.prototype,{Jm:function(t){return b.Eb(t)},nh:function(t){return new x((t=b.Eb(t)).lng,t.lat)},qh:function(t){return b.Fb(t)},wi:function(t){return t=new _(t.x,t.y),b.Fb(t)},fc:function(t,e,i,r,a){if(t)return t=this.Jm(t,a),e=this.Lc(e),new x(Math.round((t.lng-i.lng)/e+r.width/2),Math.round((i.lat-t.lat)/e+r.height/2))},zb:function(t,e,i,r,a){if(t)return e=this.Lc(e),this.qh(new _(i.lng+e*(t.x-r.width/2),i.lat-e*(t.y-r.height/2)),a)},Lc:function(t){return Math.pow(2,18-t)}});var y=b.prototype;!function(t,e){for(var i in e)t[i]=e[i]}(y,{lngLatToPoint:y.nh,pointToLngLat:y.wi});let T={Point:_,Pixel:x,MercatorProjection:b};class P{constructor(t,e){this.levelMax=t,this.levelMin=e,this.projection=new T.MercatorProjection}_getRetain(t){return Math.pow(2,t-18)}getResolution(t,e){return Math.pow(2,18-e)*Math.cos(t)}lnglatToPoint(t,e){let i=new T.Point(t,e),r=this.projection.lngLatToPoint(i);return{pointX:r.x,pointY:r.y}}pointToLnglat(t,e){let i=new T.Pixel(t,e),r=this.projection.pointToLngLat(i);return{lng:r.lng,lat:r.lat}}_lngToTileX(t,e){let i=this.lnglatToPoint(t,0);return Math.floor(i.pointX*this._getRetain(e)/256)}_latToTileY(t,e){let i=this.lnglatToPoint(0,t);return Math.floor(i.pointY*this._getRetain(e)/256)}lnglatToTile(t,e,i){return[this._lngToTileX(t,i),this._latToTileY(e,i)]}_lngToPixelX(t,e){let i=this._lngToTileX(t,e),r=this.lnglatToPoint(t,0);return Math.floor(r.pointX*this._getRetain(e)-256*i)}_latToPixelY(t,e){let i=this._latToTileY(t,e),r=this.lnglatToPoint(0,t);return Math.floor(r.pointY*this._getRetain(e)-256*i)}lnglatToPixel(t,e,i){return{pixelX:this._lngToPixelX(t,i),pixelY:this._latToPixelY(e,i)}}_pixelXToLng(t,e,i){let r=(256*e+t)/this._getRetain(i);return this.pointToLnglat(r,0).lng}_pixelYToLat(t,e,i){let r=(256*e+t)/this._getRetain(i);return this.pointToLnglat(0,r).lat}pixelToLnglat(t,e,i,r,a){let n=(256*i+t)/this._getRetain(a),o=(256*r+e)/this._getRetain(a),s=this.pointToLnglat(n,o);return[s.lng,s.lat]}}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L(t,e,i){return e&&j(t.prototype,e),i&&j(t,i),t}var E={exports:{}};!function(t){function e(i){"@babel/helpers - typeof";return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=e=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),e(i)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0}(E);var A=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(E.exports);function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function S(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,a,n=[],o=!0,s=!1;try{for(i=i.call(t);!(o=(r=i.next()).done)&&(n.push(r.value),!e||n.length!==e);o=!0);}catch(t){s=!0,a=t}finally{try{o||null==i.return||i.return()}finally{if(s)throw a}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return N(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?N(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var z,D=1e-6,I="undefined"!=typeof Float32Array?Float32Array:Array;function O(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*a+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*a+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*a+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*a+i[11]*n+i[15]*o,t}function U(t,e){var i,r,a,n=O([],e,t);return i=n,r=n,a=1/n[3],i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=r[3]*a,n}function k(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],f=e[10],g=e[11],d=e[12],M=e[13],v=e[14],_=e[15],x=i[0],m=i[1],b=i[2],y=i[3];return t[0]=x*r+m*s+b*c+y*d,t[1]=x*a+m*h+b*p+y*M,t[2]=x*n+m*l+b*f+y*v,t[3]=x*o+m*u+b*g+y*_,x=i[4],m=i[5],b=i[6],y=i[7],t[4]=x*r+m*s+b*c+y*d,t[5]=x*a+m*h+b*p+y*M,t[6]=x*n+m*l+b*f+y*v,t[7]=x*o+m*u+b*g+y*_,x=i[8],m=i[9],b=i[10],y=i[11],t[8]=x*r+m*s+b*c+y*d,t[9]=x*a+m*h+b*p+y*M,t[10]=x*n+m*l+b*f+y*v,t[11]=x*o+m*u+b*g+y*_,x=i[12],m=i[13],b=i[14],y=i[15],t[12]=x*r+m*s+b*c+y*d,t[13]=x*a+m*h+b*p+y*M,t[14]=x*n+m*l+b*f+y*v,t[15]=x*o+m*u+b*g+y*_,t}function B(t,e,i){var r,a,n,o,s,h,l,u,c,p,f,g,d=i[0],M=i[1],v=i[2];return e===t?(t[12]=e[0]*d+e[4]*M+e[8]*v+e[12],t[13]=e[1]*d+e[5]*M+e[9]*v+e[13],t[14]=e[2]*d+e[6]*M+e[10]*v+e[14],t[15]=e[3]*d+e[7]*M+e[11]*v+e[15]):(r=e[0],a=e[1],n=e[2],o=e[3],s=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],f=e[10],g=e[11],t[0]=r,t[1]=a,t[2]=n,t[3]=o,t[4]=s,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=p,t[10]=f,t[11]=g,t[12]=r*d+s*M+c*v+e[12],t[13]=a*d+h*M+p*v+e[13],t[14]=n*d+l*M+f*v+e[14],t[15]=o*d+u*M+g*v+e[15]),t}function Z(t,e,i){var r=i[0],a=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function X(t,e){var i=t[0],r=t[1],a=t[2],n=t[3],o=t[4],s=t[5],h=t[6],l=t[7],u=t[8],c=t[9],p=t[10],f=t[11],g=t[12],d=t[13],M=t[14],v=t[15],_=e[0],x=e[1],m=e[2],b=e[3],y=e[4],T=e[5],P=e[6],w=e[7],j=e[8],L=e[9],E=e[10],A=e[11],F=e[12],R=e[13],C=e[14],N=e[15];return Math.abs(i-_)<=D*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(r-x)<=D*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(a-m)<=D*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(n-b)<=D*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(o-y)<=D*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(s-T)<=D*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(h-P)<=D*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(l-w)<=D*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(u-j)<=D*Math.max(1,Math.abs(u),Math.abs(j))&&Math.abs(c-L)<=D*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(p-E)<=D*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(f-A)<=D*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(g-F)<=D*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(d-R)<=D*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(M-C)<=D*Math.max(1,Math.abs(M),Math.abs(C))&&Math.abs(v-N)<=D*Math.max(1,Math.abs(v),Math.abs(N))}function Y(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function G(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),z=new I(4),I!=Float32Array&&(z[0]=0,z[1]=0,z[2]=0,z[3]=0),function(){var t,e=(t=new I(2),I!=Float32Array&&(t[0]=0,t[1]=0),t)}(),function(){var t,e=(t=new I(3),I!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t)}();var K=Math.PI,q=K/4,W=K/180,J=180/K,V=512,H=4003e4,$=1.5;function Q(t){return Math.pow(2,t)}function tt(t,e){var i=S(t,2),r=i[0],a=i[1];G(Number.isFinite(r)&&Number.isFinite(e)),G(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude");var n=a*W;return[(e*=V)*(r*W+K)/(2*K),e*(K-Math.log(Math.tan(q+.5*n)))/(2*K)]}function et(t,e){var i=S(t,2),r=i[0],a=i[1],n=r/(e*=V)*(2*K)-K,o=2*(Math.atan(Math.exp(K-a/e*(2*K)))-q);return[n*J,o*J]}function it(t){var e,i,r,a,n,o,s,h,l,u,c,p,f,g=t.height,d=t.pitch,M=t.bearing,v=t.altitude,_=t.center,x=void 0===_?null:_,m=t.flipY,b=void 0!==m&&m,y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return B(y,y,[0,0,-v]),Z(y,y,[1,1,1/g]),e=y,i=y,r=-d*W,a=Math.sin(r),n=Math.cos(r),o=i[4],s=i[5],h=i[6],l=i[7],u=i[8],c=i[9],p=i[10],f=i[11],i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*n+u*a,e[5]=s*n+c*a,e[6]=h*n+p*a,e[7]=l*n+f*a,e[8]=u*n-o*a,e[9]=c*n-s*a,e[10]=p*n-h*a,e[11]=f*n-l*a,function(t,e,i){var r=Math.sin(i),a=Math.cos(i),n=e[0],o=e[1],s=e[2],h=e[3],l=e[4],u=e[5],c=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*a+l*r,t[1]=o*a+u*r,t[2]=s*a+c*r,t[3]=h*a+p*r,t[4]=l*a-n*r,t[5]=u*a-o*r,t[6]=c*a-s*r,t[7]=p*a-h*r}(y,y,M*W),b&&Z(y,y,[1,-1,1]),x&&B(y,y,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],x)),y}function rt(t){var e=t.width,i=t.height,r=t.pitch,a=function(t){var e=t.width,i=t.height,r=t.altitude,a=void 0===r?$:r,n=t.pitch,o=void 0===n?0:n,s=t.nearZMultiplier,h=void 0===s?1:s,l=t.farZMultiplier,u=void 0===l?1:l,c=o*W,p=Math.atan(.5/a),f=Math.sin(p)*a/Math.sin(Math.PI/2-c-p),g=Math.cos(Math.PI/2-c)*f+a;return{fov:2*Math.atan(i/2/a),aspect:e/i,focalDistance:a,near:h,far:g*u}}({width:e,height:i,altitude:t.altitude,pitch:r,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier});return function(t,e,i,r,a){var n,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(n=1/(r-a),t[10]=(a+r)*n,t[14]=2*a*r*n):(t[10]=-1,t[14]=-2*r),t}([],a.fov,a.aspect,a.near,a.far)}function at(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=S(t,3),a=r[0],n=r[1],o=r[2];if(G(Number.isFinite(a)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return U(e,[a,n,o,1]);var s=U(e,[a,n,0,1]),h=U(e,[a,n,1,1]),l=s[2],u=h[2];return function(t,e,i,r){var a=e[0],n=e[1];return t[0]=a+r*(i[0]-a),t[1]=n+r*(i[1]-n),t}([],s,h,l===u?0:((i||0)-l)/(u-l))}var nt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ot=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.width,r=e.height,a=e.viewMatrix,n=void 0===a?nt:a,o=e.projectionMatrix,s=void 0===o?nt:o;w(this,t),this.width=i||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=n,this.projectionMatrix=s;var h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];k(h,h,this.projectionMatrix),k(h,h,this.viewMatrix),this.viewProjectionMatrix=h;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Z(l,l,[this.width/2,-this.height/2,1]),B(l,l,[1,-1,0]),k(l,l,this.viewProjectionMatrix);var u,c,p,f,g,d,M,v,_,x,m,b,y,T,P,j,L,E,A,F,R,C,N,S,z,D,I,O,U,X,Y,G=(u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=(c=l)[0],f=c[1],g=c[2],d=c[3],M=c[4],v=c[5],_=c[6],x=c[7],m=c[8],b=c[9],y=c[10],T=c[11],P=c[12],j=c[13],L=c[14],E=c[15],(Y=(A=p*v-f*M)*(X=y*E-T*L)-(F=p*_-g*M)*(U=b*E-T*j)+(R=p*x-d*M)*(O=b*L-y*j)+(C=f*_-g*v)*(I=m*E-T*P)-(N=f*x-d*v)*(D=m*L-y*P)+(S=g*x-d*_)*(z=m*j-b*P))?(Y=1/Y,u[0]=(v*X-_*U+x*O)*Y,u[1]=(g*U-f*X-d*O)*Y,u[2]=(j*S-L*N+E*C)*Y,u[3]=(y*N-b*S-T*C)*Y,u[4]=(_*I-M*X-x*D)*Y,u[5]=(p*X-g*I+d*D)*Y,u[6]=(L*R-P*S-E*F)*Y,u[7]=(m*S-y*R+T*F)*Y,u[8]=(M*U-v*I+x*z)*Y,u[9]=(f*I-p*U-d*z)*Y,u[10]=(P*N-j*R+E*A)*Y,u[11]=(b*R-m*N-T*A)*Y,u[12]=(v*D-M*O-_*z)*Y,u[13]=(p*O-f*D+g*z)*Y,u[14]=(j*F-P*C-L*A)*Y,u[15]=(m*C-b*F+y*A)*Y,u):null);if(!G)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=G,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return L(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&X(e.projectionMatrix,this.projectionMatrix)&&X(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,i=void 0===e||e,r=function(t,e){var i=S(t,3),r=i[0],a=i[1],n=i[2],o=void 0===n?0:n;return G(Number.isFinite(r)&&Number.isFinite(a)&&Number.isFinite(o)),U(e,[r,a,o,1])}(this.projectPosition(t),this.pixelProjectionMatrix),a=S(r,2),n=a[0],o=a[1],s=i?o:this.height-o;return 2===t.length?[n,s]:[n,s,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,r=void 0===i||i,a=e.targetZ,n=S(t,3),o=n[0],s=n[1],h=n[2],l=r?s:this.height-s,u=a&&a*this.pixelsPerMeter,c=at([o,l,h],this.pixelUnprojectionMatrix,u),p=S(this.unprojectPosition(c),3),f=p[0],g=p[1],d=p[2];return Number.isFinite(h)?[f,g,d]:Number.isFinite(a)?[f,g,a]:[f,g]}},{key:"projectPosition",value:function(t){var e=S(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=S(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}}]),t}();function st(t){var e=t.width,i=t.height,r=t.bounds,a=t.minExtent,n=void 0===a?0:a,o=t.maxZoom,s=void 0===o?24:o,h=t.padding,l=void 0===h?0:h,u=t.offset,c=void 0===u?[0,0]:u,p=S(r,2),f=S(p[0],2),g=f[0],d=f[1],M=S(p[1],2),v=M[0],_=M[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else G(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var x=new ht({width:e,height:i,longitude:0,latitude:0,zoom:0}),m=x.project([g,_]),b=x.project([v,d]),y=[Math.max(Math.abs(b[0]-m[0]),n),Math.max(Math.abs(b[1]-m[1]),n)],T=[e-l.left-l.right-2*Math.abs(c[0]),i-l.top-l.bottom-2*Math.abs(c[1])];G(T[0]>0&&T[1]>0);var P=T[0]/y[0],w=T[1]/y[1],j=(l.right-l.left)/2/P,L=(l.bottom-l.top)/2/w,E=[(b[0]+m[0])/2+j,(b[1]+m[1])/2+L],A=x.unproject(E),F=x.zoom+Math.log2(Math.abs(Math.min(P,w)));return{longitude:A[0],latitude:A[1],zoom:Math.min(F,s)}}var ht=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.width,a=i.height,n=i.latitude,o=void 0===n?0:n,s=i.longitude,h=void 0===s?0:s,l=i.zoom,u=void 0===l?0:l,c=i.pitch,p=void 0===c?0:c,f=i.bearing,g=void 0===f?0:f,d=i.altitude,M=void 0===d?1.5:d,v=i.nearZMultiplier,_=i.farZMultiplier;w(this,e),r=r||1,a=a||1;var x=Q(u);M=Math.max(.75,M);var m=tt([h,o],x);m[2]=0;var b,y,T=rt({width:r,height:a,pitch:p,bearing:g,altitude:M,nearZMultiplier:v||1/a,farZMultiplier:_||1.01}),P=it({height:a,center:m,pitch:p,bearing:g,altitude:M,flipY:!0});return b=this,(t=!(y=R(e).call(this,{width:r,height:a,viewMatrix:P,projectionMatrix:T}))||"object"!==A(y)&&"function"!=typeof y?F(b):y).latitude=o,t.longitude=h,t.zoom=u,t.pitch=p,t.bearing=g,t.altitude=M,t.scale=x,t.center=m,t.pixelsPerMeter=function(t){var e=t.latitude,i=t.longitude,r=t.zoom,a=t.scale,n=t.highPrecision,o=void 0!==n&&n;a=void 0!==a?a:Q(r),G(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(a));var s={},h=V*a,l=Math.cos(e*W),u=h/360,c=u/l,p=h/H/l;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[u,-c,p],s.degreesPerPixel=[1/u,-1/c,1/p],o){var f=W*Math.tan(e*W)/l,g=u*f/2,d=h/H*f,M=d/c*p;s.pixelsPerDegree2=[0,-g,d],s.pixelsPerMeter2=[M,0,M]}return s}(F(F(t))).pixelsPerMeter[2],Object.freeze(F(F(t))),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(e,ot),L(e,[{key:"projectFlat",value:function(t){return tt(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(t){return et(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e,i,r=t.lngLat,a=at(t.pos,this.pixelUnprojectionMatrix),n=Y([],tt(r,this.scale),((e=[])[0]=-(i=a)[0],e[1]=-i[1],e));return et(Y([],this.center,n),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"fitBounds",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,a=this.height,n=st(Object.assign({width:r,height:a,bounds:t},i));return new e({width:r,height:a,longitude:n.longitude,latitude:n.latitude,zoom:n.zoom})}}]),e}();const lt=Math.PI/180,ut=512,ct=4003e4;function pt(t){return Math.pow(2,t)}return class{constructor(e,i,r){this.id=e,this.type="custom",this.renderingMode="2d",this.url=i,this.tileType="bd09",this.options={subdomains:null,minZoom:3,maxZoom:18},function(e,i){for(var r in e.hasOwnProperty("options")||(e.options=e.options?t(e.options):{}),i)e.options[r]=i[r];e.options}(this,r),this.program,this.showTiles=[],this.tileCache={},this.gridCache={},this.matrix,this.map,this.isLayerShow,this.transformBaidu=new P}onAdd(t,e){this.map=t;var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_TextCoord;varying vec2 v_TextCoord;const float TILE_SIZE = 512.0;const float PI = 3.1415926536;const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);uniform float u_project_scale;uniform bool u_is_offset;uniform vec3 u_pixels_per_degree;uniform vec3 u_pixels_per_degree2;uniform vec3 u_pixels_per_meter;uniform vec2 u_viewport_center;uniform vec4 u_viewport_center_projection;uniform vec2 u_viewport_size;float project_scale(float meters) {    return meters * u_pixels_per_meter.z;}vec3 project_scale(vec3 position) {    return position * u_pixels_per_meter;}vec2 project_mercator(vec2 lnglat) {    float x = lnglat.x;    return vec2(    radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))    );}vec4 project_offset(vec4 offset) {    float dy = offset.y;    dy = clamp(dy, -1., 1.);    vec3 pixels_per_unit = u_pixels_per_degree + u_pixels_per_degree2 * dy;    return vec4(offset.xyz * pixels_per_unit, offset.w);}vec4 project_position(vec4 position) {    if (u_is_offset) {        float X = position.x - u_viewport_center.x;        float Y = position.y - u_viewport_center.y;        return project_offset(vec4(X, Y, position.z, position.w));    }    else {        return vec4(        project_mercator(position.xy) * WORLD_SCALE * u_project_scale, project_scale(position.z), position.w        );    }}vec4 project_to_clipping_space(vec3 position) {    vec4 project_pos = project_position(vec4(position, 1.0));    return u_matrix * project_pos + u_viewport_center_projection;}void main() {   vec4 project_pos = project_position(vec4(a_pos, 0.0, 1.0));   gl_Position = u_matrix * project_pos + u_viewport_center_projection;   v_TextCoord = a_TextCoord;}"),e.compileShader(i);var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,"precision mediump float;uniform sampler2D u_Sampler; varying vec2 v_TextCoord; void main() {    gl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);}"),e.compileShader(r),this.program=e.createProgram(),e.attachShader(this.program,i),e.attachShader(this.program,r),e.linkProgram(this.program),this.a_Pos=e.getAttribLocation(this.program,"a_pos"),this.a_TextCoord=e.getAttribLocation(this.program,"a_TextCoord"),this.isLayerShow=!0,t.on("move",()=>{this.isLayerShow&&this.update(e,t)}),this.update(e,t)}update(t,e){var i,r,a=e.getCenter(),n=parseInt(e.getZoom())+1,o=e.getBounds();if("xyz"===this.tileType){var h=u(o.getNorthWest()),c=u(o.getSouthEast());i=s(h.lng,h.lat,n),r=s(c.lng,c.lat,n)}else if("bd09"===this.tileType){var p=l(o.getSouthWest()),f=l(o.getNorthEast());i=this.transformBaidu.lnglatToTile(p.lng,p.lat,n),r=this.transformBaidu.lnglatToTile(f.lng,f.lat,n)}for(var g=[],d=i[0];d<=r[0];d++)for(var M=i[1];M<=r[1];M++){var v={x:d,y:M,z:n};g.push(v),this.addGridCache(v,0,0),d===r[0]&&this.addGridCache(v,1,0),M===r[1]&&this.addGridCache(v,0,1),d===r[0]&&M===r[1]&&this.addGridCache(v,1,1)}if("xyz"===this.tileType)var _=s(a.lng,a.lat,n);else"bd09"===this.tileType&&(_=this.transformBaidu.lnglatToTile(a.lng,a.lat,n));for(var v of(g.sort((t,e)=>this.tileDistance(t,_)-this.tileDistance(e,_)),this.showTiles=[],g))if(this.tileCache[this.createTileKey(v)])this.showTiles.push(this.tileCache[this.createTileKey(v)]);else{var x=this.createTile(t,v);this.showTiles.push(x),this.tileCache[this.createTileKey(v)]=x}}addGridCache(t,e,i){var a=this.createTileKey(t.x+e,t.y+i,t.z);this.gridCache[a]||("xyz"===this.tileType?this.gridCache[a]=c(function(t,e,i){let a=Math.pow(2,i);return[t/a*360-180,180*Math.atan(Math.sinh(r*(1-2*e/a)))/r]}(t.x+e,t.y+i,t.z)):"bd09"===this.tileType&&(this.gridCache[a]=h(this.transformBaidu.pixelToLnglat(0,0,t.x+e,t.y+i,t.z))))}tileDistance(t,e){return Math.sqrt(Math.pow(t.x-e[0],2)+Math.pow(t.y-e[1],2))}createTileKey(t,e,i){return t instanceof Object?t.z+"/"+t.x+"/"+t.y:i+"/"+t+"/"+e}createTile(t,i){var r,a,n=(r=this.url,a={s:this.options.subdomains[Math.abs(i.x+i.y)%this.options.subdomains.length],x:i.x,y:i.y,z:i.z},r.replace(e,function(t,e){var i=a[e];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(a)),i})),o={xyz:i};"xyz"===this.tileType?(this.gridCache[this.createTileKey(i)],this.gridCache[this.createTileKey(i.x+1,i.y,i.z)],this.gridCache[this.createTileKey(i.x,i.y+1,i.z)],this.gridCache[this.createTileKey(i.x+1,i.y+1,i.z)]):"bd09"===this.tileType&&(this.gridCache[this.createTileKey(i.x,i.y+1,i.z)],this.gridCache[this.createTileKey(i.x+1,i.y+1,i.z)],this.gridCache[this.createTileKey(i)],this.gridCache[this.createTileKey(i.x+1,i.y,i.z)]);var s=new Float32Array([116.38967958133532,39.90811009556515,0,1,116.38967958133532,39.90294980726742,0,0,116.39486013141436,39.90811009556515,1,1,116.39486013141436,39.90294980726742,1,0]),h=s.BYTES_PER_ELEMENT,l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),o.buffer=l,o.PosParam={size:2,stride:4*h,offset:0},o.TextCoordParam={size:2,stride:4*h,offset:2*h};var u=new Image;return u.onload=(()=>{o.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,o.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,u),o.isLoad=!0,this.map.triggerRepaint()}),u.crossOrigin=!0,u.src=n,o}render(t,e){if(!(this.map.getZoom()<this.options.minZoom||this.map.getZoom()>this.options.maxZoom))for(var i of(this.matrix=e,t.useProgram(this.program),this.showTiles))if(i.isLoad){t.bindTexture(t.TEXTURE_2D,i.texture),t.activeTexture(t.TEXTURE0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT);var r=t.getUniformLocation(this.program,"u_Sampler");t.uniform1i(r,0),t.bindBuffer(t.ARRAY_BUFFER,i.buffer),t.vertexAttribPointer(this.a_Pos,i.PosParam.size,t.FLOAT,!1,i.PosParam.stride,i.PosParam.offset),t.vertexAttribPointer(this.a_TextCoord,i.TextCoordParam.size,t.FLOAT,!1,i.TextCoordParam.stride,i.TextCoordParam.offset),t.enableVertexAttribArray(this.a_Pos),t.enableVertexAttribArray(this.a_TextCoord),this.setVertex(t),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}setVertex(t){const e=this.map.getZoom(),i=this.map.getBearing(),r=this.map.getPitch(),a=this.map.getCenter(),n=new ht({width:t.drawingBufferWidth,height:t.drawingBufferHeight,longitude:a.lng,latitude:a.lat,zoom:e,pitch:r,bearing:i}),{viewProjectionMatrix:o,projectionMatrix:s,viewMatrix:h,viewMatrixUncentered:l}=n;let u={u_matrix:o,u_point_size:this.pointSize,u_is_offset:!1,u_pixels_per_degree:[0,0,0],u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:[0,0,0],u_project_scale:pt(e),u_viewport_center_projection:[0,0,0,0]};if(e>12){const{pixelsPerDegree:t,pixelsPerDegree2:i}=function(t){let{latitude:e=0,zoom:i=1,scale:r,highPrecision:a=!1}=t;r=void 0!==r?r:pt(i);const n={},o=ut*r,s=Math.cos(e*lt),h=o/360,l=h/s,u=o/ct/s;if(n.pixelsPerMeter=[u,-u,u],n.metersPerPixel=[1/u,-1/u,1/u],n.pixelsPerDegree=[h,-l,u],n.degreesPerPixel=[1/h,-1/l,1/u],a){const t=lt*Math.tan(e*lt)/s,i=h*t/2,r=o/ct*t,a=r/l*u;n.pixelsPerDegree2=[0,-i,r],n.pixelsPerMeter2=[a,0,a]}return n}({longitude:a.lng,latitude:a.lat,zoom:e,highPrecision:!0}),r=n.projectFlat([Math.fround(a.lng),Math.fround(a.lat)],Math.pow(2,e)),c=O([],[r[0],r[1],0,1],o);let p=k([],s,l||h);p=k([],p,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),u.u_matrix=p,u.u_is_offset=!0,u.u_viewport_center=[Math.fround(a.lng),Math.fround(a.lat)],u.u_viewport_center_projection=c,u.u_pixels_per_degree=t&&t.map(t=>Math.fround(t)),u.u_pixels_per_degree2=i&&i.map(t=>Math.fround(t))}t.uniformMatrix4fv(t.getUniformLocation(this.program,"u_matrix"),!1,u.u_matrix),t.uniform1f(t.getUniformLocation(this.program,"u_project_scale"),u.u_project_scale),t.uniform1i(t.getUniformLocation(this.program,"u_is_offset"),u.u_is_offset?1:0),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree"),u.u_pixels_per_degree),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree2"),u.u_pixels_per_degree2),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_meter"),u.u_pixels_per_meter),t.uniform2fv(t.getUniformLocation(this.program,"u_viewport_center"),u.u_viewport_center),t.uniform4fv(t.getUniformLocation(this.program,"u_viewport_center_projection"),u.u_viewport_center_projection)}onRemove(t,e){this.isLayerShow=!1}}});